<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cursos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Open+Sans&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #f8f8f3;
      background-image: url('images/fondo-patron.png');
      background-repeat: repeat;
      background-size: auto;
      padding-top: 60px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      font-family: 'Merriweather', serif;
      font-size: 2rem;
      text-transform: uppercase;
      color: #6e6651;
      margin-bottom: 20px;
      text-align: center;
    }
    .accordion-button {
      font-weight: bold;
      background-color: #9DA588;
      color: white;
    }
    .accordion-button:not(.collapsed) {
      background-color: #6e6651;
      color: #fff;
    }
    label {
      font-weight: 600;
      margin-top: 10px;
    }
    .form-control {
      margin-bottom: 5px;
    }
    .btn-custom {
      background-color: #9DA588;
      color: white;
      border: none;
    }
    .btn-custom:hover {
      background-color: #6e6651;
    }
    .error-msg {
      color: red;
      font-size: 0.9em;
      margin-bottom: 10px;
    }
    footer {
      text-align: center;
      margin-top: 40px;
    }
    footer img {
      height: 100px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Solicita tu Guía Pericial en Formato Físico</h1>

    <div class="accordion" id="formAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingForm">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseForm" aria-expanded="false" aria-controls="collapseForm">
            Solicitar Guía
          </button>
        </h2>
        <div id="collapseForm" class="accordion-collapse collapse" aria-labelledby="headingForm" data-bs-parent="#formAccordion">
          <div class="accordion-body">
            <form id="formulario" novalidate>
              <label for="nombre">Nombre</label>
              <input type="text" id="nombre" class="form-control" required />
              <div class="error-msg" id="error-nombre"></div>

              <label for="apellido">Apellido</label>
              <input type="text" id="apellido" class="form-control" required />
              <div class="error-msg" id="error-apellido"></div>

              <label for="correo">Correo Electrónico</label>
              <input type="email" id="correo" class="form-control" required />
              <div class="error-msg" id="error-correo"></div>

              <label for="contrasena">Contraseña</label>
              <input type="password" id="contrasena" class="form-control" required />
              <div class="error-msg" id="error-contrasena"></div>

              <label for="direccion">Dirección</label>
              <input type="text" id="direccion" class="form-control" required />
              <div class="error-msg" id="error-direccion"></div>

              <label for="ciudad">Ciudad</label>
              <input type="text" id="ciudad" class="form-control" required />
              <div class="error-msg" id="error-ciudad"></div>

              <label for="cp">Código Postal</label>
              <input type="text" id="cp" class="form-control" required />
              <div class="error-msg" id="error-cp"></div>

              <label for="pais">País</label>
              <input type="text" id="pais" class="form-control" required />
              <div class="error-msg" id="error-pais"></div>

              <button type="submit" class="btn btn-custom mt-2">Enviar solicitud</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <img src="images/logo_icon.png" alt="Logo Guía Técnica" /><br /><br />
      <a href="index.html" class="btn btn-custom">Volver al Inicio</a>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const form = document.getElementById('formulario');

    function mostrarError(idCampo, mensaje) {
      document.getElementById(`error-${idCampo}`).innerText = mensaje;
    }

    function limpiarErrores() {
      ['nombre', 'apellido', 'correo', 'contrasena', 'direccion', 'ciudad', 'cp', 'pais'].forEach(id => {
        mostrarError(id, '');
      });
    }

    form.addEventListener('submit', async function (e) {
      e.preventDefault();
      limpiarErrores();

      const nombre = document.getElementById('nombre').value.trim();
      const apellido = document.getElementById('apellido').value.trim();
      const correo = document.getElementById('correo').value.trim();
      const contrasena = document.getElementById('contrasena').value.trim();
      const direccion = document.getElementById('direccion').value.trim();
      const ciudad = document.getElementById('ciudad').value.trim();
      const cp = document.getElementById('cp').value.trim();
      const pais = document.getElementById('pais').value.trim();

      let errores = false;
      if (!nombre) mostrarError('nombre', 'El nombre es obligatorio'), errores = true;
      if (!apellido) mostrarError('apellido', 'El apellido es obligatorio'), errores = true;
      if (!correo || !/\S+@\S+\.\S+/.test(correo)) mostrarError('correo', 'Correo electrónico no válido'), errores = true;
      if (!contrasena || contrasena.length < 6) mostrarError('contrasena', 'La contraseña debe tener al menos 6 caracteres'), errores = true;
      if (!direccion) mostrarError('direccion', 'La dirección es obligatoria'), errores = true;
      if (!ciudad) mostrarError('ciudad', 'La ciudad es obligatoria'), errores = true;
      if (!cp) mostrarError('cp', 'El código postal es obligatorio'), errores = true;
      if (!pais) mostrarError('pais', 'El país es obligatorio'), errores = true;

      if (errores) return;

      try {
        const res = await fetch('http://localhost:3001/send', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nombre, apellido, correo, contrasena, direccion, ciudad, cp, pais })
        });

        const data = await res.json();

        if (res.ok) {
          Swal.fire({ icon: 'success', title: 'Solicitud enviada', text: data.message });
          form.reset();
        } else {
          Swal.fire({ icon: 'error', title: 'Error', text: data.error || 'No se pudo enviar la solicitud.' });
        }
      } catch (error) {
        Swal.fire({ icon: 'error', title: 'Error de conexión', text: 'No se pudo conectar al servidor.' });
      }
    });
  </script>
</body>
</html>
